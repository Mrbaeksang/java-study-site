<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”’ JWT ì¸ì¦ - ìŠ¤í”„ë§ ë¶€íŠ¸ ì™„ì „ ì •ë³µ</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš© */
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ”’ JWT ì¸ì¦</h1>
      <p class="intro-text">JWT(JSON Web Token)ë¥¼ í™œìš©í•œ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ë°©ë²•ì„ ë°°ì›Œë³´ì„¸ìš”.</p>
    </header>

    <main>
      <div class="section">
        <h2>1. JWT ì†Œê°œ</h2>
        <div class="code-block">
          <pre><code class="java">@Configuration
public class JwtConfig {
    private final String SECRET_KEY = "your-secret-key";
    private final long EXPIRATION = 1000 * 60 * 60 * 24; // 24ì‹œê°„

    public String generateToken(UserDetails userDetails) {
        return Jwts.builder()
            .setSubject(userDetails.getUsername())
            .setIssuedAt(new Date())
            .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION))
            .signWith(getSignInKey(), SignatureAlgorithm.HS256)
            .compact();
    }

    private Key getSignInKey() {
        byte[] keyBytes = Decoders.BASE64.decode(SECRET_KEY);
        return Keys.hmacShaKeyFor(keyBytes);
    }
}</code></pre>
        </div>
      </div>

      <div class="section">
        <h2>2. JWT í•„í„° êµ¬í˜„</h2>
        <div class="code-block">
          <pre><code class="java">@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
    
    @Autowired
    private JwtService jwtService;
    
    @Autowired
    private UserDetailsService userDetailsService;

    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                  HttpServletResponse response,
                                  FilterChain filterChain)
        throws ServletException, IOException {
        
        final String authHeader = request.getHeader("Authorization");
        final String jwt;
        final String username;

        if (authHeader == null || !authHeader.startsWith("Bearer ")) {
            filterChain.doFilter(request, response);
            return;
        }

        jwt = authHeader.substring(7);
        username = jwtService.extractUsername(jwt);

        if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {
            UserDetails userDetails = this.userDetailsService.loadUserByUsername(username);
            
            if (jwtService.isTokenValid(jwt, userDetails)) {
                UsernamePasswordAuthenticationToken authToken = new UsernamePasswordAuthenticationToken(
                    userDetails, null, userDetails.getAuthorities()
                );
                authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                SecurityContextHolder.getContext().setAuthentication(authToken);
            }
        }
        filterChain.doFilter(request, response);
    }
}</code></pre>
        </div>
      </div>

      <div class="section">
        <h2>3. JWT ì„œë¹„ìŠ¤ êµ¬í˜„</h2>
        <div class="code-block">
          <pre><code class="java">@Service
public class JwtService {
    
    private final String SECRET_KEY = "your-secret-key";
    private final long EXPIRATION = 1000 * 60 * 60 * 24;

    public String extractUsername(String token) {
        return extractClaim(token, Claims::getSubject);
    }

    public <T> T extractClaim(String token, Function<Claims, T> claimsResolver) {
        final Claims claims = extractAllClaims(token);
        return claimsResolver.apply(claims);
    }

    public String generateToken(UserDetails userDetails) {
        return generateToken(new HashMap<>(), userDetails);
    }

    public String generateToken(
        Map<String, Object> extraClaims,
        UserDetails userDetails
    ) {
        return Jwts
            .builder()
            .setClaims(extraClaims)
            .setSubject(userDetails.getUsername())
            .setIssuedAt(new Date(System.currentTimeMillis()))
            .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION))
            .signWith(getSignInKey(), SignatureAlgorithm.HS256)
            .compact();
    }

    public boolean isTokenValid(String token, UserDetails userDetails) {
        final String username = extractUsername(token);
        return (username.equals(userDetails.getUsername()) && !isTokenExpired(token));
    }

    private boolean isTokenExpired(String token) {
        return extractExpiration(token).before(new Date());
    }

    private Date extractExpiration(String token) {
        return extractClaim(token, Claims::getExpiration);
    }

    private Claims extractAllClaims(String token) {
        return Jwts
            .parserBuilder()
            .setSigningKey(getSignInKey())
            .build()
            .parseClaimsJws(token)
            .getBody();
    }

    private Key getSignInKey() {
        byte[] keyBytes = Decoders.BASE64.decode(SECRET_KEY);
        return Keys.hmacShaKeyFor(keyBytes);
    }
}</code></pre>
        </div>
      </div>

      <div class="section">
        <h2>4. ë‹¤ìŒ ë‹¨ê³„</h2>
        <p>ì´ì œ JWT ì¸ì¦ì˜ ê¸°ë³¸ì ì¸ êµ¬í˜„ì„ ë°°ì› ìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì£¼ì œë“¤ì„ ë°°ìš°ê²Œ ë©ë‹ˆë‹¤:</p>
        <ul>
          <li><a href="spring_boot_oauth2.html">OAuth2 ì—°ë™</a></li>
          <li><a href="spring_boot_csrf.html">CSRF ë³´í˜¸</a></li>
          <li><a href="spring_boot_security.html">ìŠ¤í”„ë§ ì‹œíë¦¬í‹°</a></li>
        </ul>
      </div>
    </main>
  </div>
</body>
</html>
