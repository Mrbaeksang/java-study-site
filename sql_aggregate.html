<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š SQL ì§‘ê³„ í•¨ìˆ˜ - SQL ì™„ë²½ ê°€ì´ë“œ</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .section {
      background: var(--vscode-darker);
      border: 1px solid var(--vscode-highlight);
      border-radius: 8px;
      margin: 2rem auto;
      padding: 2rem;
      max-width: 1000px;
    }
    h1, h2, h3, h4 {
      color: #4ec9b0;
    }
    h2 {
      border-bottom: 2px solid var(--vscode-highlight);
      padding-bottom: 0.5rem;
      margin-top: 2.5rem;
    }
    h3 {
      margin-top: 2rem;
      color: #9cdcfe;
    }
    h4 {
      margin-top: 1.5rem;
      color: #ce9178;
    }
    p, li {
      line-height: 1.7;
      color: var(--vscode-text);
    }
    code {
      background: var(--vscode-textCodeBlock-background);
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-family: 'Courier New', Courier, monospace;
    }
    pre {
      background: var(--vscode-textCodeBlock-background);
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
    }
    .note {
      border-left: 4px solid #4ec9b0;
      padding: 1rem;
      margin: 1.5rem 0;
      background: rgba(78, 201, 176, 0.1);
    }
    .warning {
      border-left: 4px solid #ff9800;
      padding: 1rem;
      margin: 1.5rem 0;
      background: rgba(255, 152, 0, 0.1);
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin: 2rem 0;
    }
    .nav-button {
      padding: 0.75rem 1.5rem;
      background: var(--vscode-button-background);
      color: var(--vscode-button-foreground);
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-decoration: none;
      font-size: 1rem;
    }
    .nav-button:hover {
      background: var(--vscode-button-hoverBackground);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }
    th, td {
      border: 1px solid var(--vscode-highlight);
      padding: 0.75rem;
      text-align: left;
    }
    th {
      background-color: var(--vscode-editor-lineHighlightBorder);
      color: var(--vscode-text);
    }
    .function-table {
      width: 100%;
      margin: 1.5rem 0;
    }
    .function-table th, .function-table td {
      padding: 0.75rem;
      border: 1px solid var(--vscode-highlight);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ“Š SQL ì§‘ê³„ í•¨ìˆ˜</h1>
      <p class="intro-text">ë°ì´í„°ë¥¼ ìš”ì•½í•˜ê³  ë¶„ì„í•˜ëŠ” SQL ì§‘ê³„ í•¨ìˆ˜ì— ëŒ€í•´ í•™ìŠµí•©ë‹ˆë‹¤. ê·¸ë£¹í™”, í•„í„°ë§, ì •ë ¬ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ë‹ˆë‹¤.</p>
    </header>

    <main>
      <div class="section">
        <h2>ğŸ” ì§‘ê³„ í•¨ìˆ˜ ê°œìš”</h2>
        <p>ì§‘ê³„ í•¨ìˆ˜ëŠ” ì—¬ëŸ¬ í–‰ì˜ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”í•˜ì—¬ ë‹¨ì¼ ê°’ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì£¼ë¡œ GROUP BY ì ˆê³¼ í•¨ê»˜ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
        
        <div class="note">
          <h3>ğŸ“Œ ì£¼ìš” ì§‘ê³„ í•¨ìˆ˜</h3>
          <table class="function-table">
            <tr>
              <th>í•¨ìˆ˜</th>
              <th>ì„¤ëª…</th>
              <th>ì§€ì› ë°ì´í„° íƒ€ì…</th>
              <th>NULL ì²˜ë¦¬</th>
            </tr>
            <tr>
              <td>COUNT()</td>
              <td>í–‰ì˜ ê°œìˆ˜ë¥¼ ë°˜í™˜</td>
              <td>ëª¨ë“  íƒ€ì…</td>
              <td>NULL ì œì™¸</td>
            </tr>
            <tr>
              <td>SUM()</td>
              <td>í•©ê³„ë¥¼ ê³„ì‚°</td>
              <td>ìˆ«ì íƒ€ì…</td>
              <td>NULL ì œì™¸</td>
            </tr>
            <tr>
              <td>AVG()</td>
              <td>í‰ê· ì„ ê³„ì‚°</td>
              <td>ìˆ«ì íƒ€ì…</td>
              <td>NULL ì œì™¸</td>
            </tr>
            <tr>
              <td>MAX()</td>
              <td>ìµœëŒ€ê°’ ë°˜í™˜</td>
              <td>ëª¨ë“  ë¹„êµ ê°€ëŠ¥í•œ íƒ€ì…</td>
              <td>NULL ì œì™¸</td>
            </tr>
            <tr>
              <td>MIN()</td>
              <td>ìµœì†Œê°’ ë°˜í™˜</td>
              <td>ëª¨ë“  ë¹„êµ ê°€ëŠ¥í•œ íƒ€ì…</td>
              <td>NULL ì œì™¸</td>
            </tr>
            <tr>
              <td>GROUP_CONCAT()</td>
              <td>ë¬¸ìì—´ ì—°ê²° (MySQL)</td>
              <td>ë¬¸ìì—´</td>
              <td>NULL ì œì™¸</td>
            </tr>
            <tr>
              <td>STRING_AGG()</td>
              <td>ë¬¸ìì—´ ì—°ê²° (SQL Server, PostgreSQL)</td>
              <td>ë¬¸ìì—´</td>
              <td>NULL ì œì™¸</td>
            </tr>
          </table>
        </div>
      </div>

      <div class="section">
        <h2>ğŸ“Š ê¸°ë³¸ ì§‘ê³„ í•¨ìˆ˜</h2>
        
        <h3>1. COUNT() - í–‰ì˜ ê°œìˆ˜ ì„¸ê¸°</h3>
        <pre><code>-- ì „ì²´ í–‰ ìˆ˜
SELECT COUNT(*) FROM Orders;

-- íŠ¹ì • ì»¬ëŸ¼ì˜ NULLì´ ì•„ë‹Œ ê°’ì˜ ìˆ˜
SELECT COUNT(CustomerID) FROM Orders;

-- ê³ ìœ í•œ ê°’ì˜ ìˆ˜
SELECT COUNT(DISTINCT CustomerID) FROM Orders;</code></pre>

        <h3>2. SUM() - í•©ê³„ ê³„ì‚°</h3>
        <pre><code>-- ì£¼ë¬¸ ì´ì•¡ í•©ê³„
SELECT SUM(Amount) AS TotalAmount FROM Orders;

-- ì¡°ê±´ì— ë§ëŠ” ì£¼ë¬¸ì˜ í•©ê³„
SELECT SUM(Amount) AS HighValueOrders 
FROM Orders 
WHERE Amount > 1000;</code></pre>

        <h3>3. AVG() - í‰ê·  ê³„ì‚°</h3>
        <pre><code>-- í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡
SELECT AVG(Amount) AS AvgOrderAmount FROM Orders;

-- NULL ê°’ì´ ìˆëŠ” ê²½ìš°ì˜ í‰ê·  (NULLì€ ì œì™¸ë¨)
SELECT AVG(COALESCE(Amount, 0)) AS AvgWithNulls FROM Orders;</code></pre>

        <h3>4. MAX() / MIN() - ìµœëŒ€ê°’/ìµœì†Œê°’</h3>
        <pre><code>-- ê°€ì¥ ë¹„ì‹¼ ì£¼ë¬¸ ê¸ˆì•¡
SELECT MAX(Amount) AS MaxOrderAmount FROM Orders;

-- ê°€ì¥ ì˜¤ë˜ëœ ì£¼ë¬¸ì¼
SELECT MIN(OrderDate) AS FirstOrderDate FROM Orders;

-- ê°€ì¥ ë¹„ì‹¼ ìƒí’ˆì˜ ì •ë³´
SELECT * FROM Products 
WHERE Price = (SELECT MAX(Price) FROM Products);</code></pre>
      </div>

      <div class="section">
        <h2>ğŸ“ˆ GROUP BY - ê·¸ë£¹í™”</h2>
        <p>ì§€ì •í•œ ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹ì„ ë§Œë“¤ì–´ ê° ê·¸ë£¹ë³„ë¡œ ì§‘ê³„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
        
        <h3>ê¸°ë³¸ ì‚¬ìš©ë²•</h3>
        <pre><code>-- ê³ ê°ë³„ ì£¼ë¬¸ ê±´ìˆ˜
SELECT CustomerID, COUNT(*) AS OrderCount
FROM Orders
GROUP BY CustomerID
ORDER BY OrderCount DESC;</code></pre>

        <h3>ì—¬ëŸ¬ ì»¬ëŸ¼ìœ¼ë¡œ ê·¸ë£¹í™”</h3>
        <pre><code>-- ì—°ë„ë³„, ì›”ë³„ ë§¤ì¶œ í•©ê³„
SELECT 
    YEAR(OrderDate) AS OrderYear,
    MONTH(OrderDate) AS OrderMonth,
    SUM(Amount) AS MonthlySales
FROM Orders
GROUP BY YEAR(OrderDate), MONTH(OrderDate)
ORDER BY OrderYear, OrderMonth;</code></pre>

        <h3>HAVING ì ˆë¡œ ê·¸ë£¹ í•„í„°ë§</h3>
        <pre><code>-- 10ê±´ ì´ìƒ ì£¼ë¬¸í•œ ê³ ê°
SELECT CustomerID, COUNT(*) AS OrderCount
FROM Orders
GROUP BY CustomerID
HAVING COUNT(*) >= 10
ORDER BY OrderCount DESC;</code></pre>

        <div class="note">
          <h3>ğŸ“ WHERE vs HAVING</h3>
          <ul>
            <li><strong>WHERE</strong>: ê·¸ë£¹í™” ì „ì— í–‰ì„ í•„í„°ë§ (ì§‘ê³„ í•¨ìˆ˜ ì‚¬ìš© ë¶ˆê°€)</li>
            <li><strong>HAVING</strong>: ê·¸ë£¹í™” í›„ì— ê·¸ë£¹ì„ í•„í„°ë§ (ì§‘ê³„ í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥)</li>
          </ul>
        </div>
      </div>

      <div class="section">
        <h2>ğŸ“Š ê³ ê¸‰ ì§‘ê³„ ê¸°ë²•</h2>
        
        <h3>1. ROLLUP - ì†Œê³„/ì´ê³„ ìƒì„±</h3>
        <pre><code>-- ì—°ë„ë³„, ë¶„ê¸°ë³„ ë§¤ì¶œ ì†Œê³„ ë° ì´ê³„
SELECT 
    YEAR(OrderDate) AS OrderYear,
    QUARTER(OrderDate) AS OrderQuarter,
    SUM(Amount) AS TotalAmount
FROM Orders
GROUP BY ROLLUP(YEAR(OrderDate), QUARTER(OrderDate))
ORDER BY OrderYear, OrderQuarter;</code></pre>

        <h3>2. CUBE - ëª¨ë“  ì¡°í•©ì˜ ì†Œê³„ ìƒì„±</h3>
        <pre><code>-- ì—°ë„, ë¶„ê¸°, ì§€ì—­ë³„ ëª¨ë“  ì¡°í•©ì˜ ì†Œê³„
SELECT 
    YEAR(OrderDate) AS OrderYear,
    QUARTER(OrderDate) AS OrderQuarter,
    Region,
    SUM(Amount) AS TotalAmount
FROM Orders
GROUP BY CUBE(YEAR(OrderDate), QUARTER(OrderDate), Region)
ORDER BY OrderYear, OrderQuarter, Region;</code></pre>

        <h3>3. GROUPING SETS - ì‚¬ìš©ì ì •ì˜ ê·¸ë£¹í™”</h3>
        <pre><code>-- ì—°ë„ë³„, ë¶„ê¸°ë³„, ì—°ë„+ë¶„ê¸°ë³„ ê·¸ë£¹í™”
SELECT 
    YEAR(OrderDate) AS OrderYear,
    QUARTER(OrderDate) AS OrderQuarter,
    SUM(Amount) AS TotalAmount
FROM Orders
GROUP BY GROUPING SETS (
    (YEAR(OrderDate)),
    (QUARTER(OrderDate)),
    (YEAR(OrderDate), QUARTER(OrderDate))
)
ORDER BY OrderYear, OrderQuarter;</code></pre>

        <h3>4. ìœˆë„ìš° í•¨ìˆ˜ì™€ í•¨ê»˜ ì‚¬ìš©</h3>
        <pre><code>-- ê³ ê°ë³„ ëˆ„ì  ì£¼ë¬¸ ê¸ˆì•¡
SELECT 
    CustomerID,
    OrderDate,
    Amount,
    SUM(Amount) OVER (PARTITION BY CustomerID ORDER BY OrderDate) AS RunningTotal
FROM Orders
ORDER BY CustomerID, OrderDate;</code></pre>
      </div>

      <div class="section">
        <h2>ğŸ“ ì§‘ê³„ í•¨ìˆ˜ ì£¼ì˜ì‚¬í•­</h2>
        
        <div class="warning">
          <h3>âš ï¸ NULL ê°’ ì²˜ë¦¬</h3>
          <p>ì§‘ê³„ í•¨ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ NULL ê°’ì„ ë¬´ì‹œí•©ë‹ˆë‹¤. NULLì„ 0ìœ¼ë¡œ ì²˜ë¦¬í•˜ë ¤ë©´ COALESCEë‚˜ CASE ë¬¸ì„ ì‚¬ìš©í•˜ì„¸ìš”.</p>
          <pre><code>-- NULLì„ 0ìœ¼ë¡œ ì²˜ë¦¬í•œ í‰ê· 
SELECT AVG(COALESCE(Amount, 0)) AS AvgWithZeros FROM Orders;</code></pre>
        </div>

        <div class="warning">
          <h3>âš ï¸ GROUP BYì™€ SELECT ì»¬ëŸ¼</h3>
          <p>GROUP BYë¥¼ ì‚¬ìš©í•  ë•Œ SELECT ì ˆì—ëŠ” ê·¸ë£¹í™” ì»¬ëŸ¼ì´ë‚˜ ì§‘ê³„ í•¨ìˆ˜ë§Œ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <pre><code>-- ì˜ëª»ëœ ì˜ˆ (ProductNameì´ GROUP BYì— ì—†ìŒ)
SELECT CategoryID, ProductName, AVG(Price)
FROM Products
GROUP BY CategoryID;

-- ì˜¬ë°”ë¥¸ ì˜ˆ 1: ProductNameì„ GROUP BYì— ì¶”ê°€
SELECT CategoryID, ProductName, AVG(Price)
FROM Products
GROUP BY CategoryID, ProductName;

-- ì˜¬ë°”ë¥¸ ì˜ˆ 2: ProductName ì œê±°
SELECT CategoryID, AVG(Price)
FROM Products
GROUP BY CategoryID;</code></pre>
        </div>

        <div class="warning">
          <h3>âš ï¸ ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­</h3>
          <ul>
            <li>ëŒ€ìš©ëŸ‰ í…Œì´ë¸”ì—ì„œ ì§‘ê³„ë¥¼ ìì£¼ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ê²½ìš°, ìš”ì•½ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•˜ì„¸ìš”.</li>
            <li>GROUP BY ì ˆì— ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ì»¬ëŸ¼ì„ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            <li>DISTINCTëŠ” ì„±ëŠ¥ì— í° ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë‹ˆ ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.</li>
          </ul>
        </div>
      </div>

      <div class="section">
        <h2>ğŸ“Š ì‹¤ì „ ì˜ˆì œ: ì˜ì—… ë³´ê³ ì„œ ìƒì„±</h2>
        <p>ë‹¤ì–‘í•œ ì§‘ê³„ í•¨ìˆ˜ë¥¼ í™œìš©í•œ ì‹¤ì „ ì˜ˆì œë¥¼ ì‚´í´ë´…ì‹œë‹¤.</p>
        
        <h3>1. ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œ ë¶„ì„</h3>
        <pre><code>SELECT 
    c.CategoryName,
    COUNT(o.OrderID) AS OrderCount,
    SUM(od.Quantity * od.UnitPrice) AS TotalRevenue,
    AVG(od.Quantity * od.UnitPrice) AS AvgOrderValue,
    MAX(od.Quantity * od.UnitPrice) AS MaxOrderValue,
    MIN(od.Quantity * od.UnitPrice) AS MinOrderValue
FROM Categories c
JOIN Products p ON c.CategoryID = p.CategoryID
JOIN OrderDetails od ON p.ProductID = od.ProductID
JOIN Orders o ON od.OrderID = o.OrderID
WHERE o.OrderDate BETWEEN '2023-01-01' AND '2023-12-31'
GROUP BY c.CategoryID, c.CategoryName
ORDER BY TotalRevenue DESC;</code></pre>

        <h3>2. ì›”ë³„ ë§¤ì¶œ ì¶”ì´ ë¶„ì„ (í”¼ë²— í…Œì´ë¸”)</h3>
        <pre><code>-- MySQL
SELECT 
    p.ProductName,
    SUM(CASE WHEN MONTH(o.OrderDate) = 1 THEN od.Quantity * od.UnitPrice ELSE 0 END) AS Jan,
    SUM(CASE WHEN MONTH(o.OrderDate) = 2 THEN od.Quantity * od.UnitPrice ELSE 0 END) AS Feb,
    -- ... 12ì›”ê¹Œì§€ ë°˜ë³µ
    SUM(CASE WHEN MONTH(o.OrderDate) = 12 THEN od.Quantity * od.UnitPrice ELSE 0 END) AS Dec,
    SUM(od.Quantity * od.UnitPrice) AS YearTotal
FROM Products p
JOIN OrderDetails od ON p.ProductID = od.ProductID
JOIN Orders o ON od.OrderID = o.OrderID
WHERE YEAR(o.OrderDate) = 2023
GROUP BY p.ProductID, p.ProductName
ORDER BY YearTotal DESC
LIMIT 10;</code></pre>

        <h3>3. ê³ ê° êµ¬ë§¤ íŒ¨í„´ ë¶„ì„</h3>
        <pre><code>WITH CustomerStats AS (
    SELECT 
        c.CustomerID,
        c.CompanyName,
        COUNT(DISTINCT o.OrderID) AS OrderCount,
        SUM(od.Quantity * od.UnitPrice) AS TotalSpent,
        MAX(o.OrderDate) AS LastOrderDate,
        AVG(od.Quantity * od.UnitPrice) AS AvgOrderValue
    FROM Customers c
    JOIN Orders o ON c.CustomerID = o.CustomerID
    JOIN OrderDetails od ON o.OrderID = od.OrderID
    WHERE o.OrderDate >= DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR)
    GROUP BY c.CustomerID, c.CompanyName
    HAVING COUNT(DISTINCT o.OrderID) >= 3
)
SELECT 
    CustomerID,
    CompanyName,
    OrderCount,
    TotalSpent,
    LastOrderDate,
    AvgOrderValue,
    NTILE(5) OVER (ORDER BY TotalSpent DESC) AS SpendingSegment
FROM CustomerStats
ORDER BY TotalSpent DESC;</code></pre>
      </div>

      <div class="nav-buttons">
        <a href="sql_joins.html" class="nav-button">ì´ì „: ì¡°ì¸ (JOIN)</a>
        <a href="sql_advanced.html" class="nav-button">ë‹¤ìŒ: SQL ê³ ê¸‰ ê¸°ëŠ¥</a>
      </div>
    </main>
  </div>
</body>
</html>
